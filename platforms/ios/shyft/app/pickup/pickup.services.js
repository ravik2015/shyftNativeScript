"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var http_1 = require("@angular/http");
var ApplicationSettings = require("application-settings");
require("rxjs/add/operator/map");
require("rxjs/add/operator/do");
var angular2_uuid_1 = require("angular2-uuid");
var utils = require("../shared/utils");
var PickupService = (function () {
    function PickupService(http) {
        this.http = http;
        this.addressUUID = angular2_uuid_1.UUID.UUID();
        this.currentAppointmentGetUrl = utils.baseurl + "appointment/" + JSON.parse(ApplicationSettings.getString("appointmentid", "{}"));
    }
    PickupService.prototype.getData = function (data) {
        var lat = data.latitude;
        var long = data.longitude;
        var url = "https://maps.googleapis.com/maps/api/geocode/json?latlng=" + lat + "," + long + "&key=AIzaSyDyqz4svjh922aWBLWUmh0M94Y1J1nh2EM";
        return this.http.get(url)
            .map(function (res) { return res.json(); });
    };
    PickupService.prototype.getlatLong = function (address) {
        var url = "https://maps.googleapis.com/maps/api/place/details/json?placeid=" + address + "&key=AIzaSyAkXRQsMcFS2pVwoa4tfNe4tBRb7jhemg0";
        return this.http.get(url)
            .map(function (res) { return res.json(); });
    };
    PickupService.prototype.getModalLatLong = function (address) {
        console.log("here", address);
        var encodedAddress = encodeURI(address);
        var headers = this.latlongHeader();
        var url = "https://maps.googleapis.com/maps/api/geocode/json?address=" + encodedAddress + "&key=AIzaSyAkXRQsMcFS2pVwoa4tfNe4tBRb7jhemg0";
        return this.http.get(url, { headers: headers })
            .map(function (res) { return res.json(); });
    };
    PickupService.prototype.latlongHeader = function () {
        var headers = new http_1.Headers();
        headers.append("Content-Type", "application/json");
        return headers;
    };
    PickupService.prototype.getAddress = function (long, lat, text) {
        var url = "https://maps.googleapis.com/maps/api/place/autocomplete/json?input=" + text + "&language=en&key=AIzaSyDVHHTgO4zgOjwncPlCAs-PxC05wta3BJM";
        return this.http.get(url)
            .map(function (res) { return res.json(); });
    };
    PickupService.prototype.locationAdd = function (location) {
        this.appointmentID = JSON.parse(ApplicationSettings.getString("appointmentid", "{}"));
        var locationAddURL = "https://uat.futuredms.com/shyft-api/appointment/" + this.appointmentID + "/location";
        console.log("locationlocation  : ", JSON.stringify(location), "location URL : ", locationAddURL);
        this.id_token = JSON.parse(ApplicationSettings.getString("TOKEN", "{}"));
        var headers = new http_1.Headers();
        headers.append("Authorization", this.id_token);
        return this.http.put(locationAddURL, location, { headers: headers });
    };
    PickupService.prototype.updateAppointment = function () {
        console.log("local storage  Appointment id is : ", ApplicationSettings.getString("appointmentid"), " vendorid : ", JSON.parse(ApplicationSettings.getString("appointmentid", "{}")));
        var appointmentid = JSON.parse(ApplicationSettings.getString("appointmentid"));
        var appointmentUpdateURL = "https://uat.futuredms.com/shyft-api/appointment/" + appointmentid;
        this.id_token = JSON.parse(ApplicationSettings.getString("TOKEN", "{}"));
        var headers = new http_1.Headers();
        var date = new Date();
        var isoDate = date.toISOString();
        var appointment = {
            "id": JSON.parse(ApplicationSettings.getString("appointmentid", "{}")),
            "datetime": JSON.parse(ApplicationSettings.getString("appointmentDate", "{}")),
            "status": "Paid",
            "vendor": JSON.parse(ApplicationSettings.getString("vendorid", "{}"))
        };
        console.log("APpointment create url --> ", appointmentUpdateURL);
        console.log("Appointment PUT Data Testing : ", JSON.stringify(appointment));
        headers.append("Authorization", this.id_token);
        return this.http.put(appointmentUpdateURL, appointment, { headers: headers });
    };
    //-------------------------------- Appointment GET Request ----------------------------------//
    PickupService.prototype.currentAppointmentGet = function () {
        var headers = this.currentAppointmentGetHeader();
        return this.http.get(this.currentAppointmentGetUrl, { headers: headers })
            .map(function (res) {
            // If request fails, throw an Error that will be caught
            if (res.status < 200 || res.status >= 300) {
                throw new Error('This request has failed ' + res.status);
            }
            else {
                return res.json();
            }
        });
    };
    PickupService.prototype.currentAppointmentGetHeader = function () {
        var headers = new http_1.Headers();
        this.id_token = JSON.parse(ApplicationSettings.getString("TOKEN", "{}"));
        headers.append("Authorization", this.id_token);
        headers.append("Content-Type", "application/json");
        return headers;
    };
    PickupService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [http_1.Http])
    ], PickupService);
    return PickupService;
}());
exports.PickupService = PickupService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGlja3VwLnNlcnZpY2VzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicGlja3VwLnNlcnZpY2VzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTJDO0FBQzNDLHNDQUF3RDtBQUV4RCwwREFBNEQ7QUFFNUQsaUNBQStCO0FBQy9CLGdDQUE4QjtBQUM5QiwrQ0FBcUM7QUFFckMsdUNBQXlDO0FBR3pDO0lBT0ksdUJBQW9CLElBQVU7UUFBVixTQUFJLEdBQUosSUFBSSxDQUFNO1FBSnZCLGdCQUFXLEdBQUcsb0JBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUV6Qiw2QkFBd0IsR0FBRyxLQUFLLENBQUMsT0FBTyxHQUFHLGNBQWMsR0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLG1CQUFtQixDQUFDLFNBQVMsQ0FBQyxlQUFlLEVBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUVoRyxDQUFDO0lBRTVCLCtCQUFPLEdBQWQsVUFBZSxJQUFJO1FBQ2YsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUN4QixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQzFCLElBQUksR0FBRyxHQUFHLDJEQUEyRCxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsSUFBSSxHQUFHLDhDQUE4QyxDQUFDO1FBQzFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUM7YUFDcEIsR0FBRyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFWLENBQVUsQ0FBQyxDQUFDO0lBRWhDLENBQUM7SUFHTSxrQ0FBVSxHQUFqQixVQUFrQixPQUFPO1FBQ3JCLElBQUksR0FBRyxHQUFHLGtFQUFrRSxHQUFDLE9BQU8sR0FBQyw4Q0FBOEMsQ0FBQTtRQUNuSSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDO2FBQ3hCLEdB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LE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLENBQUM7YUFDeEUsR0FBRyxDQUFDLFVBQUEsR0FBRztZQUNKLHVEQUF1RDtZQUN2RCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsTUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ3pDLE1BQU0sSUFBSSxLQUFLLENBQUMsMEJBQTBCLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzNELENBQUM7WUFFRCxJQUFJLENBQUMsQ0FBQztnQkFDSixNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3BCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNULENBQUM7SUFFTyxtREFBMkIsR0FBbkM7UUFDSSxJQUFJLE9BQU8sR0FBRyxJQUFJLGNBQU8sRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7UUFFeEUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQy9DLE9BQU8sQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFLGtCQUFrQixDQUFDLENBQUM7UUFDbkQsTUFBTSxDQUFDLE9BQU8sQ0FBQztJQUNuQixDQUFDO0lBekhRLGFBQWE7UUFEekIsaUJBQVUsRUFBRTt5Q0FRaUIsV0FBSTtPQVByQixhQUFhLENBNEh6QjtJQUFELG9CQUFDO0NBQUEsQUE1SEQsSUE0SEM7QUE1SFksc0NBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IEh0dHAsIEhlYWRlcnMsIFJlc3BvbnNlIH0gZnJvbSBcIkBhbmd1bGFyL2h0dHBcIjtcbmltcG9ydCB7IE9ic2VydmFibGUgYXMgUnhPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anMvT2JzZXJ2YWJsZVwiO1xuaW1wb3J0ICogYXMgQXBwbGljYXRpb25TZXR0aW5ncyBmcm9tIFwiYXBwbGljYXRpb24tc2V0dGluZ3NcIjtcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzL09ic2VydmFibGUnO1xuaW1wb3J0IFwicnhqcy9hZGQvb3BlcmF0b3IvbWFwXCI7XG5pbXBvcnQgXCJyeGpzL2FkZC9vcGVyYXRvci9kb1wiO1xuaW1wb3J0IHsgVVVJRCB9IGZyb20gJ2FuZ3VsYXIyLXV1aWQnO1xuaW1wb3J0IHsgaXNBbmRyb2lkLCBpc0lPUywgZGV2aWNlLCBzY3JlZW4gfSBmcm9tIFwicGxhdGZvcm1cIjtcbmltcG9ydCAqIGFzIHV0aWxzIGZyb20gJy4uL3NoYXJlZC91dGlscyc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBQaWNrdXBTZXJ2aWNlIHtcblxuICAgIHB1YmxpYyBhcHBvaW50bWVudElEO1xuICAgIHB1YmxpYyBhZGRyZXNzVVVJRCA9IFVVSUQuVVVJRCgpO1xuICAgIHByaXZhdGUgaWRfdG9rZW47XG4gICAgcHJpdmF0ZSBjdXJyZW50QXBwb2ludG1lbnRHZXRVcmwgPSB1dGlscy5iYXNldXJsICsgXCJhcHBvaW50bWVudC9cIitKU09OLnBhcnNlKEFwcGxpY2F0aW9uU2V0dGluZ3MuZ2V0U3RyaW5nKFwiYXBwb2ludG1lbnRpZFwiLFwie31cIikpO1xuICAgIFxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cCkgeyB9XG5cbiAgICBwdWJsaWMgZ2V0RGF0YShkYXRhKSB7XG4gICAgICAgIGxldCBsYXQgPSBkYXRhLmxhdGl0dWRlO1xuICAgICAgICBsZXQgbG9uZyA9IGRhdGEubG9uZ2l0dWRlO1xuICAgICAgICBsZXQgdXJsID0gXCJodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvZ2VvY29kZS9qc29uP2xhdGxuZz1cIiArIGxhdCArIFwiLFwiICsgbG9uZyArIFwiJmtleT1BSXphU3lEeXF6NHN2amg5MjJhV0JMV1VtaDBNOTRZMUoxbmgyRU1cIjtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgICAgICAgLm1hcChyZXMgPT4gcmVzLmpzb24oKSk7XG5cbiAgICB9XG5cblxuICAgIHB1YmxpYyBnZXRsYXRMb25nKGFkZHJlc3MpIHtcbiAgICAgICAgbGV0IHVybCA9IFwiaHR0cHM6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL3BsYWNlL2RldGFpbHMvanNvbj9wbGFjZWlkPVwiK2FkZHJlc3MrXCIma2V5PUFJemFTeUFrWFJRc01jRlMycFZ3b2E0dGZOZTR0QlJiN2poZW1nMFwiXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybClcbiAgICAgICAgLm1hcChyZXMgPT4gcmVzLmpzb24oKSk7XG4gICAgfVxuXG5cbiAgICBwdWJsaWMgZ2V0TW9kYWxMYXRMb25nKGFkZHJlc3MpIHsgIFxuICAgICAgICBjb25zb2xlLmxvZyhcImhlcmVcIixhZGRyZXNzICkgIFxuICAgICAgICBsZXQgZW5jb2RlZEFkZHJlc3MgPSBlbmNvZGVVUkkoYWRkcmVzcylcbiAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLmxhdGxvbmdIZWFkZXIoKTtcbiAgICAgICAgbGV0IHVybCA9IFwiaHR0cHM6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL2dlb2NvZGUvanNvbj9hZGRyZXNzPVwiK2VuY29kZWRBZGRyZXNzK1wiJmtleT1BSXphU3lBa1hSUXNNY0ZTMnBWd29hNHRmTmU0dEJSYjdqaGVtZzBcIlxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwsIHsgaGVhZGVyczogaGVhZGVycyB9KVxuICAgICAgICAubWFwKChyZXM6IFJlc3BvbnNlKSA9PiByZXMuanNvbigpKTtcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBsYXRsb25nSGVhZGVyKCkge1xuICAgICAgICBsZXQgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XG4gICAgICAgIGhlYWRlcnMuYXBwZW5kKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTsgICAgICAgIFxuICAgICAgICByZXR1cm4gaGVhZGVycztcbiAgICB9ICBcblxuICAgIHB1YmxpYyBnZXRBZGRyZXNzKGxvbmcsIGxhdCwgdGV4dCkge1xuICAgICAgICBsZXQgdXJsID0gXCJodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvcGxhY2UvYXV0b2NvbXBsZXRlL2pzb24/aW5wdXQ9XCIgKyB0ZXh0ICsgXCImbGFuZ3VhZ2U9ZW4ma2V5PUFJemFTeURWSEhUZ080emdPanduY1BsQ0FzLVB4QzA1d3RhM0JKTVwiO1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpXG4gICAgICAgICAgICAubWFwKHJlcyA9PiByZXMuanNvbigpKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgbG9jYXRpb25BZGQobG9jYXRpb24pIHtcbiAgICAgICAgdGhpcy5hcHBvaW50bWVudElEID0gSlNPTi5wYXJzZShBcHBsaWNhdGlvblNldHRpbmdzLmdldFN0cmluZyhcImFwcG9pbnRtZW50aWRcIixcInt9XCIpKVxuICAgICAgICBcbiAgICAgICAgbGV0IGxvY2F0aW9uQWRkVVJMID0gXCJodHRwczovL3VhdC5mdXR1cmVkbXMuY29tL3NoeWZ0LWFwaS9hcHBvaW50bWVudC9cIiArIHRoaXMuYXBwb2ludG1lbnRJRCArIFwiL2xvY2F0aW9uXCI7XG5cbiAgICAgICAgY29uc29sZS5sb2coXCJsb2NhdGlvbmxvY2F0aW9uICA6IFwiLCBKU09OLnN0cmluZ2lmeShsb2NhdGlvbiksIFwibG9jYXRpb24gVVJMIDogXCIsIGxvY2F0aW9uQWRkVVJMKTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuaWRfdG9rZW4gPSBKU09OLnBhcnNlKEFwcGxpY2F0aW9uU2V0dGluZ3MuZ2V0U3RyaW5nKFwiVE9LRU5cIixcInt9XCIpKSAgICAgICAgICAgIFxuICAgICAgICBcbiAgICAgICAgbGV0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xuICAgICAgICBoZWFkZXJzLmFwcGVuZChcIkF1dGhvcml6YXRpb25cIiwgdGhpcy5pZF90b2tlbik7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wdXQoXG4gICAgICAgICAgICBsb2NhdGlvbkFkZFVSTCxcbiAgICAgICAgICAgIGxvY2F0aW9uLFxuICAgICAgICAgICAgeyBoZWFkZXJzOiBoZWFkZXJzIH1cbiAgICAgICAgKVxuICAgICAgICAgIFxuICAgIH1cblxuXG5cbiAgICBwdWJsaWMgdXBkYXRlQXBwb2ludG1lbnQoKXtcbiAgICAgICAgY29uc29sZS5sb2coXCJsb2NhbCBzdG9yYWdlICBBcHBvaW50bWVudCBpZCBpcyA6IFwiLCBBcHBsaWNhdGlvblNldHRpbmdzLmdldFN0cmluZyhcImFwcG9pbnRtZW50aWRcIiksXCIgdmVuZG9yaWQgOiBcIixKU09OLnBhcnNlKEFwcGxpY2F0aW9uU2V0dGluZ3MuZ2V0U3RyaW5nKFwiYXBwb2ludG1lbnRpZFwiLFwie31cIikpKVxuICAgICAgICBcbiAgICAgICAgbGV0IGFwcG9pbnRtZW50aWQgPSBKU09OLnBhcnNlKEFwcGxpY2F0aW9uU2V0dGluZ3MuZ2V0U3RyaW5nKFwiYXBwb2ludG1lbnRpZFwiKSlcbiAgICAgICAgXG4gICAgICAgIGxldCBhcHBvaW50bWVudFVwZGF0ZVVSTCA9IFwiaHR0cHM6Ly91YXQuZnV0dXJlZG1zLmNvbS9zaHlmdC1hcGkvYXBwb2ludG1lbnQvXCIgKyBhcHBvaW50bWVudGlkO1xuXG4gICAgICAgIHRoaXMuaWRfdG9rZW4gPSBKU09OLnBhcnNlKEFwcGxpY2F0aW9uU2V0dGluZ3MuZ2V0U3RyaW5nKFwiVE9LRU5cIixcInt9XCIpKSAgICAgICAgICAgIFxuICAgICAgICBcbiAgICAgICAgbGV0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xuICAgICAgICBsZXQgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGxldCBpc29EYXRlID0gZGF0ZS50b0lTT1N0cmluZygpO1xuICAgICAgIGxldCAgYXBwb2ludG1lbnQgPSB7XG4gICAgICAgICAgICBcImlkXCI6IEpTT04ucGFyc2UoQXBwbGljYXRpb25TZXR0aW5ncy5nZXRTdHJpbmcoXCJhcHBvaW50bWVudGlkXCIsXCJ7fVwiKSksXG4gICAgICAgICAgICBcImRhdGV0aW1lXCI6IEpTT04ucGFyc2UoQXBwbGljYXRpb25TZXR0aW5ncy5nZXRTdHJpbmcoXCJhcHBvaW50bWVudERhdGVcIixcInt9XCIpKSxcbiAgICAgICAgICAgIFwic3RhdHVzXCI6IFwiUGFpZFwiLFxuICAgICAgICAgICAgXCJ2ZW5kb3JcIjogSlNPTi5wYXJzZShBcHBsaWNhdGlvblNldHRpbmdzLmdldFN0cmluZyhcInZlbmRvcmlkXCIsXCJ7fVwiKSlcbiAgICAgICAgfTtcbiAgICAgICAgY29uc29sZS5sb2coXCJBUHBvaW50bWVudCBjcmVhdGUgdXJsIC0tPiBcIixhcHBvaW50bWVudFVwZGF0ZVVSTCkgICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZyhcIkFwcG9pbnRtZW50IFBVVCBEYXRhIFRlc3RpbmcgOiBcIiwgSlNPTi5zdHJpbmdpZnkoYXBwb2ludG1lbnQpKTtcbiAgICAgICAgaGVhZGVycy5hcHBlbmQoXCJBdXRob3JpemF0aW9uXCIsIHRoaXMuaWRfdG9rZW4pO1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnB1dChcbiAgICAgICAgICAgICAgICBhcHBvaW50bWVudFVwZGF0ZVVSTCxcbiAgICAgICAgICAgICAgICAgICAgYXBwb2ludG1lbnQsXG4gICAgICAgICAgICAgICAgICAgIHsgaGVhZGVyczogaGVhZGVycyB9XG4gICAgICAgICAgICAgICAgKVxuICAgIH1cblxuICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIEFwcG9pbnRtZW50IEdFVCBSZXF1ZXN0IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0vL1xuXG4gICAgIHB1YmxpYyBjdXJyZW50QXBwb2ludG1lbnRHZXQoKSB7XG4gICAgICAgIGxldCBoZWFkZXJzID0gdGhpcy5jdXJyZW50QXBwb2ludG1lbnRHZXRIZWFkZXIoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodGhpcy5jdXJyZW50QXBwb2ludG1lbnRHZXRVcmwsIHsgaGVhZGVyczogaGVhZGVycyB9KVxuICAgICAgICAubWFwKHJlcyA9PiB7XG4gICAgICAgICAgICAvLyBJZiByZXF1ZXN0IGZhaWxzLCB0aHJvdyBhbiBFcnJvciB0aGF0IHdpbGwgYmUgY2F1Z2h0XG4gICAgICAgICAgICBpZihyZXMuc3RhdHVzIDwgMjAwIHx8IHJlcy5zdGF0dXMgPj0gMzAwKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhpcyByZXF1ZXN0IGhhcyBmYWlsZWQgJyArIHJlcy5zdGF0dXMpO1xuICAgICAgICAgICAgfSBcbiAgICAgICAgICAgIC8vIElmIGV2ZXJ5dGhpbmcgd2VudCBmaW5lLCByZXR1cm4gdGhlIHJlc3BvbnNlXG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjdXJyZW50QXBwb2ludG1lbnRHZXRIZWFkZXIoKSB7XG4gICAgICAgIGxldCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcbiAgICAgICAgIHRoaXMuaWRfdG9rZW4gPSBKU09OLnBhcnNlKEFwcGxpY2F0aW9uU2V0dGluZ3MuZ2V0U3RyaW5nKFwiVE9LRU5cIixcInt9XCIpKSAgICAgICAgICAgIFxuICAgICAgICBcbiAgICAgICAgaGVhZGVycy5hcHBlbmQoXCJBdXRob3JpemF0aW9uXCIsIHRoaXMuaWRfdG9rZW4pO1xuICAgICAgICBoZWFkZXJzLmFwcGVuZChcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICAgIHJldHVybiBoZWFkZXJzO1xuICAgIH1cblxuXG59XG4iXX0=